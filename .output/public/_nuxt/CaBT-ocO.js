import{j as O,f as Q,r as f,l as y,m as R,c as i,o as d,a as l,n as g,p as n,t as p,F as x,v as M,x as C,B as D,D as w,A as X,d as N,_ as ee}from"./Dr2qh0qR.js";const te={class:"calendar"},ae={class:"month-navigation"},ne=["disabled"],le={class:"month-label"},oe=["disabled"],se={class:"calendar-grid"},re=["onClick"],ue={key:0,class:"person-picker"},ie={class:"persons-grid"},de=["onClick"],ce={key:1,class:"time-picker"},ve={class:"time-grid"},me=["onClick"],pe={key:0,class:"no-times"},fe={key:2,class:"booking-form"},he={key:3,class:"confirmation"},ke=2,ye=O({__name:"api-calendar",setup(_e){const $=Q().$axiosInstance;function j(a){const t=a.getFullYear(),e=(a.getMonth()+1).toString().padStart(2,"0"),k=a.getDate().toString().padStart(2,"0");return`${t}-${e}-${k}`}const c=f(new Date().getFullYear()),r=f(new Date().getMonth()),A=new Date,z=A.getFullYear(),F=A.getMonth(),s=f(null),u=f(null),v=f(null),m=f(null),b=f([]),S=y(()=>{if(!s.value)return[];const a=b.value.find(t=>t.date===s.value);return a?a.doctors:[]});async function V(a,t){try{const e=await $.get("/schedule/available-days",{params:{year:a,month:t+1}});b.value=e.data}catch(e){console.error("Błąd ładowania dostępnych dni:",e)}}function L(a,t){const e=[];let _=new Date(a,t,1).getDay();_=_===0?6:_-1;for(let h=0;h<_;h++)e.push({day:0,date:"",isBlank:!0});const J=new Date(a,t+1,0).getDate();for(let h=1;h<=J;h++){const K=new Date(a,t,h);e.push({day:h,date:j(K),isBlank:!1})}return e}const Y=y(()=>L(c.value,r.value)),q=y(()=>new Date(c.value,r.value).toLocaleDateString("pl-PL",{year:"numeric",month:"long"}));function B(a){return b.value.some(t=>t.date===a)}function I(a){B(a)&&(s.value=a,u.value=null,v.value=null,m.value=null)}function U(a){u.value=a,v.value=null,m.value=null}const P=y(()=>{if(!s.value||!u.value)return[];const a=b.value.find(e=>e.date===s.value);if(!a)return[];const t=a.doctors.find(e=>e.doctor_id===u.value);return t?t.free_slots:[]});function E(a){v.value=a,m.value=null}const o=f({name:"",surname:"",phone:"",email:""});async function G(){if(!(!s.value||!u.value||!v.value)){if(!o.value.name||!o.value.surname||!o.value.phone||!o.value.email)return alert("Wypełnij wszystkie pola formularza");try{await $.post("/schedule/reserve",{doctor_id:u.value,name:o.value.name,surname:o.value.surname,phone:o.value.phone,email:o.value.email,date:s.value,hour:v.value});const a=S.value.find(t=>t.doctor_id===u.value);m.value={date:s.value,personName:a?`${a.name} ${a.surname}`:"",hour:v.value},await V(c.value,r.value),s.value=null,u.value=null,v.value=null,o.value={name:"",surname:"",phone:"",email:""}}catch(a){alert("Błąd rezerwacji: "+a)}}}const T=y(()=>c.value>z||c.value===z&&r.value>F),W=y(()=>{const a=z*12+F+ke;return c.value*12+r.value<a});function Z(){T.value&&(r.value===0?(r.value=11,c.value-=1):r.value-=1)}function H(){W.value&&(r.value===11?(r.value=0,c.value+=1):r.value+=1)}return R([c,r],()=>{V(c.value,r.value),s.value=null,u.value=null,v.value=null,m.value=null},{immediate:!0}),(a,t)=>(d(),i("div",te,[t[10]||(t[10]=l("h2",null,"Wybierz termin wizyty",-1)),l("div",ae,[l("button",{onClick:Z,disabled:!n(T)},"Poprzedni miesiąc",8,ne),l("span",le,p(n(q)),1),l("button",{onClick:H,disabled:!n(W)},"Następny miesiąc",8,oe)]),l("div",se,[(d(!0),i(x,null,M(n(Y),(e,k)=>(d(),i("div",{key:k,class:C(["day",e.isBlank?"blank":"",!e.isBlank&&B(e.date)?"available":"",!e.isBlank&&n(s)===e.date?"selected":""]),onClick:_=>!e.isBlank&&B(e.date)&&I(e.date)},p(e.isBlank?"":e.day),11,re))),128))]),n(s)?(d(),i("div",ue,[t[4]||(t[4]=l("h3",null,"Wybierz lekarza",-1)),l("div",ie,[(d(!0),i(x,null,M(n(S),e=>(d(),i("div",{key:e.doctor_id,class:C(["person",{selected:n(u)===e.doctor_id}]),onClick:k=>U(e.doctor_id)},p(e.name)+" "+p(e.surname),11,de))),128))])])):g("",!0),n(s)&&n(u)?(d(),i("div",ce,[l("h3",null,"Dostępne godziny dla lekarza w dniu "+p(n(s)),1),l("div",ve,[(d(!0),i(x,null,M(n(P),e=>(d(),i("div",{key:e,class:C(["time",{selected:n(v)===e}]),onClick:k=>E(e)},p(e),11,me))),128)),n(P).length===0?(d(),i("div",pe," Brak dostępnych godzin ")):g("",!0)])])):g("",!0),n(s)&&n(u)&&n(v)?(d(),i("div",fe,[t[6]||(t[6]=l("h3",null,"Formularz rezerwacji",-1)),l("form",{onSubmit:X(G,["prevent"])},[D(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n(o).name=e),placeholder:"Imię",required:""},null,512),[[w,n(o).name]]),D(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>n(o).surname=e),placeholder:"Nazwisko",required:""},null,512),[[w,n(o).surname]]),D(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n(o).phone=e),placeholder:"Telefon",required:""},null,512),[[w,n(o).phone]]),D(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>n(o).email=e),type:"email",placeholder:"Email",required:""},null,512),[[w,n(o).email]]),t[5]||(t[5]=l("button",{type:"submit",class:"btn-book"},"Zarezerwuj",-1))],32)])):g("",!0),n(m)?(d(),i("div",he,[t[7]||(t[7]=N(" Zarezerwowano termin: ",-1)),l("strong",null,p(n(m).date),1),t[8]||(t[8]=N(", lekarz: ",-1)),l("strong",null,p(n(m).personName),1),t[9]||(t[9]=N(" o godzinie ",-1)),l("strong",null,p(n(m).hour),1)])):g("",!0)]))}}),be=ee(ye,[["__scopeId","data-v-bdcec666"]]);export{be as default};
