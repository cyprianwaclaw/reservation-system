import{j as K,f as Q,r as f,l as y,m as R,c as u,o as d,a as l,n as b,p as n,t as m,F as C,v as N,x as S,B as D,D as w,A as X,d as T,_ as ee}from"./Dr2qh0qR.js";const te={class:"calendar"},ae={class:"calendar-header"},ne=["disabled"],le={class:"month-label"},oe=["disabled"],se={class:"month-navigation"},re=["disabled"],ie={class:"month-label"},ue=["disabled"],de={class:"calendar-grid"},ce=["onClick"],ve={key:0,class:"person-picker"},me={class:"persons-grid"},pe=["onClick"],he={key:1,class:"time-picker"},fe={class:"time-grid"},ke=["onClick"],_e={key:0,class:"no-times"},ye={key:2,class:"booking-form"},be={key:3,class:"confirmation"},ge=1,De=K({__name:"index-old",setup(we){const $=Q().$axiosInstance;function Y(a){const e=a.getFullYear(),t=(a.getMonth()+1).toString().padStart(2,"0"),h=a.getDate().toString().padStart(2,"0");return`${e}-${t}-${h}`}const c=f(new Date().getFullYear()),r=f(new Date().getMonth()),A=new Date,z=A.getFullYear(),F=A.getMonth(),s=f(null),i=f(null),v=f(null),p=f(null),g=f([]),P=y(()=>{if(!s.value)return[];const a=g.value.find(e=>e.date===s.value);return a?a.doctors:[]});async function V(){try{const a=new Date,e=new Date(a);e.setMonth(a.getMonth()+1);const t=e.getTime()-a.getTime(),h=Math.ceil(t/(1e3*60*60*24))+1,k=await $.get("/schedule/available-days",{params:{start_date:a.toISOString().split("T")[0],days_ahead:h}});g.value=k.data}catch(a){console.error("Błąd ładowania dostępnych dni:",a)}}function q(a,e){const t=[];let k=new Date(a,e,1).getDay();k=k===0?6:k-1;for(let _=0;_<k;_++)t.push({day:0,date:"",isBlank:!0});const H=new Date(a,e+1,0).getDate();for(let _=1;_<=H;_++){const J=new Date(a,e,_);t.push({day:_,date:Y(J),isBlank:!1})}return t}const U=y(()=>q(c.value,r.value)),W=y(()=>new Date(c.value,r.value).toLocaleDateString("pl-PL",{year:"numeric",month:"long"}));function M(a){return g.value.some(e=>e.date===a)}function E(a){M(a)&&(s.value=a,i.value=null,v.value=null,p.value=null)}function G(a){i.value=a,v.value=null,p.value=null}const j=y(()=>{if(!s.value||!i.value)return[];const a=g.value.find(t=>t.date===s.value);if(!a)return[];const e=a.doctors.find(t=>t.doctor_id===i.value);return e?e.free_slots:[]});function O(a){v.value=a,p.value=null}const o=f({name:"",surname:"",phone:"",email:""});async function Z(){if(!(!s.value||!i.value||!v.value)){if(!o.value.name||!o.value.surname||!o.value.phone||!o.value.email)return alert("Wypełnij wszystkie pola formularza");try{await $.post("/schedule/reserve",{doctor_id:i.value,name:o.value.name,surname:o.value.surname,phone:o.value.phone,email:o.value.email,date:s.value,hour:v.value});const a=P.value.find(e=>e.doctor_id===i.value);p.value={date:s.value,personName:a?`${a.name} ${a.surname}`:"",hour:v.value},await V(c.value,r.value),s.value=null,i.value=null,v.value=null,o.value={name:"",surname:"",phone:"",email:""}}catch(a){alert("Błąd rezerwacji: "+a)}}}const x=y(()=>c.value>z||c.value===z&&r.value>F),B=y(()=>{const a=z*12+F+ge;return c.value*12+r.value<a});function I(){x.value&&(r.value===0?(r.value=11,c.value-=1):r.value-=1)}function L(){B.value&&(r.value===11?(r.value=0,c.value+=1):r.value+=1)}return R([c,r],()=>{V(c.value,r.value),s.value=null,i.value=null,v.value=null,p.value=null},{immediate:!0}),(a,e)=>(d(),u("div",te,[e[10]||(e[10]=l("h2",null,"Wybierz termin wizyty",-1)),l("div",ae,[l("button",{class:"nav-btn",onClick:I,disabled:!n(x),"aria-label":"Poprzedni miesiąc"},"‹",8,ne),l("div",le,m(n(W)),1),l("button",{class:"nav-btn",onClick:L,disabled:!n(B),"aria-label":"Następny miesiąc"},"›",8,oe)]),l("div",se,[l("button",{onClick:I,disabled:!n(x)},"Poprzedni miesiąc",8,re),l("span",ie,m(n(W)),1),l("button",{onClick:L,disabled:!n(B)},"Następny miesiąc",8,ue)]),l("div",de,[(d(!0),u(C,null,N(n(U),(t,h)=>(d(),u("div",{key:h,class:S(["day",t.isBlank?"blank":"",!t.isBlank&&M(t.date)?"available":"",!t.isBlank&&n(s)===t.date?"selected":""]),onClick:k=>!t.isBlank&&M(t.date)&&E(t.date)},m(t.isBlank?"":t.day),11,ce))),128))]),n(s)?(d(),u("div",ve,[e[4]||(e[4]=l("h3",null,"Wybierz lekarza",-1)),l("div",me,[(d(!0),u(C,null,N(n(P),t=>(d(),u("div",{key:t.doctor_id,class:S(["person",{selected:n(i)===t.doctor_id}]),onClick:h=>G(t.doctor_id)},m(t.name)+" "+m(t.surname),11,pe))),128))])])):b("",!0),n(s)&&n(i)?(d(),u("div",he,[l("h3",null,"Dostępne godziny dla lekarza w dniu "+m(n(s)),1),l("div",fe,[(d(!0),u(C,null,N(n(j),t=>(d(),u("div",{key:t,class:S(["time",{selected:n(v)===t}]),onClick:h=>O(t)},m(t),11,ke))),128)),n(j).length===0?(d(),u("div",_e," Brak dostępnych godzin ")):b("",!0)])])):b("",!0),n(s)&&n(i)&&n(v)?(d(),u("div",ye,[e[6]||(e[6]=l("h3",null,"Formularz rezerwacji",-1)),l("form",{onSubmit:X(Z,["prevent"])},[D(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>n(o).name=t),placeholder:"Imię",required:""},null,512),[[w,n(o).name]]),D(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>n(o).surname=t),placeholder:"Nazwisko",required:""},null,512),[[w,n(o).surname]]),D(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>n(o).phone=t),placeholder:"Telefon",required:""},null,512),[[w,n(o).phone]]),D(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>n(o).email=t),type:"email",placeholder:"Email",required:""},null,512),[[w,n(o).email]]),e[5]||(e[5]=l("button",{type:"submit",class:"btn-book"},"Zarezerwuj",-1))],32)])):b("",!0),n(p)?(d(),u("div",be,[e[7]||(e[7]=T(" Zarezerwowano termin: ",-1)),l("strong",null,m(n(p).date),1),e[8]||(e[8]=T(", lekarz: ",-1)),l("strong",null,m(n(p).personName),1),e[9]||(e[9]=T(" o godzinie ",-1)),l("strong",null,m(n(p).hour),1)])):b("",!0)]))}}),Me=ee(De,[["__scopeId","data-v-8628c4e4"]]);export{Me as default};
